<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuD/PhD Directory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .back-button {
            display: inline-block;
            background: white;
            color: #667eea;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            margin-bottom: 1rem;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .back-button:hover {
            transform: translateX(-4px);
        }

        .controls {
            background: white;
            padding: 1.5rem;
            margin: 2rem auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .search-bar {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            margin-bottom: 1rem;
            transition: border-color 0.3s;
        }

        .search-bar:focus {
            outline: none;
            border-color: #667eea;
        }

        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #555;
        }

        .filter-group select {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .results-info {
            text-align: center;
            margin: 1rem 0;
            color: #666;
            font-size: 0.95rem;
        }

        .directory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .person-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .person-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .card-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            font-weight: 700;
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .card-position {
            font-size: 1rem;
            color: #555;
            margin-bottom: 0.5rem;
        }

        .card-institution {
            font-size: 0.9rem;
            color: #777;
        }

        .mentor-badge {
            display: inline-block;
            background: #4ade80;
            color: white;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .profile-view {
            display: none;
            max-width: 900px;
            margin: 2rem auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .profile-header {
            display: flex;
            gap: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .profile-image {
            width: 200px;
            height: 200px;
            border-radius: 12px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: 700;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .profile-position {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 0.5rem;
        }

        .profile-institution {
            font-size: 1rem;
            color: #777;
            margin-bottom: 1rem;
        }

        .profile-email {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.2s;
        }

        .profile-email:hover {
            background: #5568d3;
        }

        .profile-details {
            padding: 2rem;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-label {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .detail-value {
            color: #555;
            line-height: 1.8;
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tag {
            background: #e6e9f5;
            color: #667eea;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #999;
            font-size: 1.1rem;
        }

        footer {
            background: #2d3748;
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 3rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.1rem;
            color: #667eea;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .directory-grid {
                grid-template-columns: 1fr;
            }

            .profile-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .profile-image {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>AuD/PhD Directory</h1>
            <p class="subtitle">Connect with fellow audiologists and researchers</p>
        </div>
    </header>

    <main class="container">
        <div id="galleryView">
            <div class="controls">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-bar" 
                    placeholder="Search by name, institution, research areas, mentoring topics..."
                >
                
                <div class="filters" id="filtersContainer"></div>
            </div>

            <div class="results-info" id="resultsInfo"></div>
            
            <div id="loading" class="loading">Loading directory...</div>
            <div class="directory-grid" id="directoryGrid"></div>
        </div>

        <div id="profileView" class="profile-view">
            <a href="#" class="back-button" onclick="showGallery(); return false;">← Back to Directory</a>
            <div id="profileContent"></div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 AuD/PhD Directory. Built with ❤️ for the audiology community.</p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        let allPeople = [];
        let filteredPeople = [];
        
        // Configure multi-select fields (comma-separated values from checkboxes)
        const multiSelectFields = [
            'Current Professional Activities',
            'Research Topic Area(s)',
            'What professional topics would you be interested in providing mentoring on?',
            'What level mentee do you typically work with?',
            'What funding mechanisms do you have experience with? (e.g., NIH F32, NSF GRFP, HHF ERG'
        ];

        // Fields to display on card
        const cardFields = {
            name: 'Name (as it should be listed in the directory, i.e., First Last, credentials)',
            photo: 'Profile Picture',
            position: 'Current Position',
            institution: 'Current Affiliation (e.g., university, company name)',
            mentor: 'Do you agree to mentor individuals who reach out to you?'
        };

        // Fields to use for filtering
        const filterableFields = [
            'Research Category',
            'Research Topic Area(s)',
            'Do you agree to mentor individuals who reach out to you?',
            'What professional topics would you be interested in providing mentoring on?',
            'What level mentee do you typically work with?',
            'Did you obtain your AuD and PhD from the same institution?',
            'Did you complete your AuD and PhD simultaneously or sequentially?'
        ];

        // Fields to skip in detailed view
        const skipInDetailView = [
            'Timestamp',
            'Name (as it should be listed in the directory, i.e., First Last, credentials)',
            'Profile Picture',
            'Current Position',
            'Current Affiliation (e.g., university, company name)',
            'Email (this will be what is used for connecting with you)'
        ];

        async function loadData() {
            try {
                const response = await fetch('data.csv');
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        allPeople = results.data.map(person => {
                            const processed = {...person};
                            
                            // Process multi-select fields
                            multiSelectFields.forEach(field => {
                                if (processed[field]) {
                                    processed[field] = processed[field]
                                        .split(/[,;]/)
                                        .map(item => item.trim())
                                        .filter(item => item && item !== 'NA');
                                }
                            });
                            
                            return processed;
                        });
                        
                        filteredPeople = allPeople;
                        initializeFilters();
                        renderDirectory();
                        document.getElementById('loading').style.display = 'none';
                    },
                    error: function(error) {
                        console.error('Error parsing CSV:', error);
                        document.getElementById('loading').innerHTML = 
                            'Error loading data. Please make sure data.csv is in the same directory.';
                    }
                });
            } catch (error) {
                console.error('Error loading CSV:', error);
                document.getElementById('loading').innerHTML = 
                    'Error loading data. Please make sure data.csv is in the same directory.';
            }
        }

        function initializeFilters() {
            const filtersContainer = document.getElementById('filtersContainer');

            filterableFields.forEach(field => {
                let uniqueValues = new Set();
                
                allPeople.forEach(person => {
                    if (Array.isArray(person[field])) {
                        person[field].forEach(v => v && uniqueValues.add(v));
                    } else if (person[field] && person[field] !== 'NA') {
                        uniqueValues.add(person[field]);
                    }
                });
                
                uniqueValues = Array.from(uniqueValues).filter(v => v);
                
                if (uniqueValues.length > 0) {
                    const filterGroup = document.createElement('div');
                    filterGroup.className = 'filter-group';
                    
                    const label = document.createElement('label');
                    // Create shorter label names
                    const shortLabels = {
                        'Research Category': 'Research Category',
                        'Research Topic Area(s)': 'Research Topics',
                        'Do you agree to mentor individuals who reach out to you?': 'Available to Mentor',
                        'What professional topics would you be interested in providing mentoring on?': 'Mentoring Topics',
                        'What level mentee do you typically work with?': 'Mentee Level',
                        'Did you obtain your AuD and PhD from the same institution?': 'Same Institution',
                        'Did you complete your AuD and PhD simultaneously or sequentially?': 'Degree Timing'
                    };
                    label.textContent = shortLabels[field] || field;
                    
                    const select = document.createElement('select');
                    select.id = `filter-${field}`;
                    select.innerHTML = `<option value="">All</option>`;
                    
                    uniqueValues.sort().forEach(value => {
                        const option = document.createElement('option');
                        option.value = value;
                        option.textContent = value;
                        select.appendChild(option);
                    });
                    
                    select.addEventListener('change', applyFilters);
                    
                    filterGroup.appendChild(label);
                    filterGroup.appendChild(select);
                    filtersContainer.appendChild(filterGroup);
                }
            });
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterSelects = document.querySelectorAll('.filter-group select');
            
            filteredPeople = allPeople.filter(person => {
                // Search filter
                const searchMatch = Object.entries(person).some(([key, value]) => {
                    if (Array.isArray(value)) {
                        return value.some(v => v.toLowerCase().includes(searchTerm));
                    }
                    return value && value.toString().toLowerCase().includes(searchTerm);
                });
                
                if (!searchMatch) return false;
                
                // Dropdown filters
                for (let select of filterSelects) {
                    const field = select.id.replace('filter-', '');
                    const filterValue = select.value;
                    
                    if (filterValue) {
                        if (Array.isArray(person[field])) {
                            if (!person[field].includes(filterValue)) return false;
                        } else if (person[field] !== filterValue) {
                            return false;
                        }
                    }
                }
                
                return true;
            });
            
            renderDirectory();
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
        }

        function renderDirectory() {
            const grid = document.getElementById('directoryGrid');
            const resultsInfo = document.getElementById('resultsInfo');
            
            resultsInfo.textContent = `Showing ${filteredPeople.length} of ${allPeople.length} people`;
            
            if (filteredPeople.length === 0) {
                grid.innerHTML = '<div class="no-results">No results found. Try adjusting your search or filters.</div>';
                return;
            }
            
            grid.innerHTML = filteredPeople.map((person, index) => {
                const photoUrl = person[cardFields.photo] || '';
                const name = person[cardFields.name] || 'Unknown';
                const position = person[cardFields.position] || '';
                const institution = person[cardFields.institution] || '';
                const isMentor = person[cardFields.mentor] && person[cardFields.mentor].toLowerCase().includes('yes');
                
                const initials = getInitials(name);
                
                const imageHtml = photoUrl ? 
                    `<img src="${photoUrl}" alt="${name}" class="card-image" onerror="this.outerHTML='<div class=\\'card-image\\'>${initials}</div>';">` :
                    `<div class="card-image">${initials}</div>`;
                
                return `
                    <div class="person-card" onclick="showProfile(${allPeople.indexOf(person)})">
                        ${imageHtml}
                        <div class="card-content">
                            <div class="card-name">${name}</div>
                            <div class="card-position">${position}</div>
                            <div class="card-institution">${institution}</div>
                            ${isMentor ? '<span class="mentor-badge">Available to Mentor</span>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showProfile(personIndex) {
            const person = allPeople[personIndex];
            const photoUrl = person[cardFields.photo] || '';
            const name = person[cardFields.name] || 'Unknown';
            const position = person[cardFields.position] || '';
            const institution = person[cardFields.institution] || '';
            const email = person['Email (this will be what is used for connecting with you)'] || '';
            
            const initials = getInitials(name);
            
            const imageHtml = photoUrl ? 
                `<img src="${photoUrl}" alt="${name}" class="profile-image" onerror="this.outerHTML='<div class=\\'profile-image\\'>${initials}</div>';">` :
                `<div class="profile-image">${initials}</div>`;
            
            const detailSections = Object.entries(person)
                .filter(([key]) => !skipInDetailView.includes(key) && person[key] && person[key] !== 'NA')
                .map(([key, value]) => {
                    let displayValue;
                    
                    if (Array.isArray(value) && value.length > 0) {
                        displayValue = `
                            <div class="tag-list">
                                ${value.map(v => `<span class="tag">${v}</span>`).join('')}
                            </div>
                        `;
                    } else if (value) {
                        displayValue = `<div class="detail-value">${value}</div>`;
                    } else {
                        return '';
                    }
                    
                    return `
                        <div class="detail-section">
                            <div class="detail-label">${key}</div>
                            ${displayValue}
                        </div>
                    `;
                }).filter(s => s).join('');
            
            document.getElementById('profileContent').innerHTML = `
                <div class="profile-header">
                    ${imageHtml}
                    <div class="profile-info">
                        <div class="profile-name">${name}</div>
                        <div class="profile-position">${position}</div>
                        <div class="profile-institution">${institution}</div>
                        ${email ? `<a href="mailto:${email}" class="profile-email">Contact via Email</a>` : ''}
                    </div>
                </div>
                <div class="profile-details">
                    ${detailSections}
                </div>
            `;
            
            document.getElementById('galleryView').style.display = 'none';
            document.getElementById('profileView').style.display = 'block';
            window.scrollTo(0, 0);
        }

        function showGallery() {
            document.getElementById('galleryView').style.display = 'block';
            document.getElementById('profileView').style.display = 'none';
            window.scrollTo(0, 0);
        }

        document.getElementById('searchInput').addEventListener('input', applyFilters);
        loadData();
    </script>
</body>
</html>
